# 3.4 Verification: Prediction Test

**[↑ Up](README.md)** | **[← Previous](3.3-export-serving.md)**

---

**Folder Structure:**
```
project/
├── 3.1-optimization.md
├── 3.2-bqml-training.md
├── 3.3-export-serving.md
├── 3.4-prediction-test.md  <-- You are here
```

## Objective

We need to verify that our Docker container is correctly serving predictions. We will write a Python script to send a POST request with taxi trip details and receive a predicted tip amount.

## 1. Setup Environment

Since the Docker container occupies your previous terminal, open a **NEW** terminal tab or window.

### Step 1: Install Requirements
We need the `requests` library to send HTTP data.

```bash
pip install requests
```

## 2. Create the Test Script

### Step 2: Create File
Create a new file named `test_pred.py` in your project folder. You can do this with your code editor or by running:

```bash
touch test_pred.py
```

### Step 3: Write Code
Copy and paste the following Python code into `test_pred.py`:

```python
import requests

# The endpoint for the TensorFlow Serving container
# We are hitting localhost port 8501, specific model 'tip_model'
url = 'http://localhost:8501/v1/models/tip_model:predict'

# Defined payload matching the model's schema
# Note: Categorical features must be strings matching the Training phase
data = {
    "instances": [
        {
            "PULocationID": "132",    # JFK Airport
            "DOLocationID": "230",    # Times Square
            "payment_type": "1",      # Credit Card
            "passenger_count": 1.0,
            "trip_distance": 20.5,
            "fare_amount": 55.0,
            "tolls_amount": 6.0
        }
    ]
}

# Send the POST request
print(f"Sending request to: {url}")
response = requests.post(url, json=data)

# Parse response
if response.status_code == 200:
    prediction = response.json()['predictions'][0]
    print(f"✅ Success! Predicted Tip Amount: {prediction}")
else:
    print(f"❌ Error: {response.text}")
```

## 3. Run the Test

### Step 4: Execute Script
Run the script using Python:

```bash
python test_pred.py
```

**Expected Output:**
You should see a numeric array representing the predicted tip value.

```
Sending request to: http://localhost:8501/v1/models/tip_model:predict
✅ Success! Predicted Tip Amount: [12.4532]
```

## Conclusion

Congratulations! You have completed the comprehensive workshop.

**Summary of what you built:**
1.  **Optimized** BigQuery storage (Partitioning/Clustering).
2.  **Trained** an ML model inside BigQuery (No Python data export needed).
3.  **Exported** the model artifact to Google Cloud Storage.
4.  **Deployed** the model to a local Docker container.
5.  **Verified** predictions with a real client script.
